"use strict";(self["webpackChunkdatabasir"]=self["webpackChunkdatabasir"]||[]).push([[770],{38787:function(e,t,n){n.d(t,{aF:function(){return p},nK:function(){return r},Hj:function(){return l},Jp:function(){return i},FO:function(){return s},ri:function(){return c},KT:function(){return d},ec:function(){return f}});var a=n(63872);const o="/oauth2",p=()=>a.Z.get(o+"/apps"),r=(e,t)=>a.Z.get(o+"/authorization/"+e,{params:t}),u="/api/v1.0/oauth2_apps",l=e=>a.Z.get(u,{params:e}),i=e=>a.Z["delete"](u+"/"+e),s=e=>a.Z.get(u+"/"+e),c=e=>a.Z.post(u,e),d=e=>a.Z.patch(u,e),f=()=>a.Z.get(u+"/platforms")},63766:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(66252),o=n(3577);const p=["src"],r=["src"],u=["src"];function l(e,t,l,i,s,c){const d=(0,a.up)("el-tooltip");return"github"==l.appType.toLowerCase()?((0,a.wg)(),(0,a.j4)(d,{key:0,content:l.appName,effect:"light"},{default:(0,a.w5)((()=>[(0,a._)("img",{src:l.appIcon?l.appIcon:n(39710),style:{"max-width":"20px","max-height":"20px"}},null,8,p)])),_:1},8,["content"])):"gitlab"==l.appType.toLowerCase()?((0,a.wg)(),(0,a.j4)(d,{key:1,content:l.appName,effect:"light"},{default:(0,a.w5)((()=>[(0,a._)("img",{src:l.appIcon?l.appIcon:n(84386),style:{"max-width":"20px","max-height":"20px"}},null,8,r)])),_:1},8,["content"])):"we_work"==l.appType.toLowerCase()?((0,a.wg)(),(0,a.j4)(d,{key:2,content:l.appName,effect:"light"},{default:(0,a.w5)((()=>[(0,a._)("img",{src:l.appIcon?l.appIcon:n(51457),style:{"max-width":"20px","max-height":"20px"}},null,8,u)])),_:1},8,["content"])):((0,a.wg)(),(0,a.iD)(a.HY,{key:3},[(0,a.Uk)((0,o.zw)(l.appType),1)],64))}var i={props:{appType:String,appIcon:String,appName:String}},s=n(83744);const c=(0,s.Z)(i,[["render",l]]);var d=c},57770:function(e,t,n){n.r(t),n.d(t,{default:function(){return y}});var a=n(66252),o=n(49963);const p={class:"login-card"},r=(0,a._)("h1",null,"Databasir",-1),u=(0,a.Uk)(" 登录 "),l=(0,a.Uk)(" 忘记密码？ "),i=(0,a.Uk)(" 第三方登录 ");function s(e,t,n,s,c,d){const f=(0,a.up)("el-header"),m=(0,a.up)("el-link"),g=(0,a.up)("el-form-item"),h=(0,a.up)("el-button"),w=(0,a.up)("el-tooltip"),y=(0,a.up)("el-space"),_=(0,a.up)("oauth2-app-type"),k=(0,a.up)("el-divider"),b=(0,a.up)("el-form"),x=(0,a.up)("el-main"),v=(0,a.up)("el-container");return(0,a.wg)(),(0,a.j4)(v,null,{default:(0,a.w5)((()=>[(0,a.Wm)(f),(0,a.Wm)(x,{class:"login-main"},{default:(0,a.w5)((()=>[(0,a._)("div",p,[(0,a.Wm)(b,{ref:"formRef",rules:c.formRule,model:c.form,style:{border:"none"}},{default:(0,a.w5)((()=>[(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(m,{href:"https://github.com/vran-dev/databasir",target:"_blank",underline:!1,type:"info"},{default:(0,a.w5)((()=>[r])),_:1})])),_:1}),(0,a.Wm)(g,{prop:"username"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a._)("input",{type:"text",class:"login-input",placeholder:"用户名或邮箱","onUpdate:modelValue":t[0]||(t[0]=e=>c.form.username=e),onKeyup:t[1]||(t[1]=(0,o.D2)((e=>d.onLogin("formRef")),["enter"]))},null,544),[[o.nr,c.form.username]])])),_:1}),(0,a.Wm)(g,{prop:"password"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a._)("input",{type:"password",class:"login-input",placeholder:"密码","onUpdate:modelValue":t[2]||(t[2]=e=>c.form.password=e),onKeyup:t[3]||(t[3]=(0,o.D2)((e=>d.onLogin("formRef")),["enter"]))},null,544),[[o.nr,c.form.password]])])),_:1}),(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[(0,a.Wm)(y,{size:32},{default:(0,a.w5)((()=>[(0,a.Wm)(h,{style:{width:"120px","margin-top":"10px","border-color":"#EEE"},color:"#000",onClick:t[4]||(t[4]=e=>d.onLogin("formRef")),plain:"",round:""},{default:(0,a.w5)((()=>[u])),_:1}),(0,a.Wm)(w,{content:"请联系管理员为您重置密码"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{target:"_blank",underline:!1,type:"info"},{default:(0,a.w5)((()=>[l])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.Wm)(g,null,{default:(0,a.w5)((()=>[c.oauthApps.length>0?((0,a.wg)(),(0,a.j4)(k,{key:0,"content-position":"right"},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{size:26},{default:(0,a.w5)((()=>[i,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(c.oauthApps,((e,t)=>((0,a.wg)(),(0,a.j4)(m,{key:t,underline:!1,onClick:t=>d.onAuthLogin(e.registrationId)},{default:(0,a.w5)((()=>[(0,a.Wm)(_,{"app-type":e.appType,"app-icon":e.appIcon,"app-name":e.appName},null,8,["app-type","app-icon","app-name"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):(0,a.kq)("",!0)])),_:1})])),_:1},8,["rules","model"])])])),_:1})])),_:1})}var c=n(40152),d=n(51836),f=n(38787),m=n(63766),g={components:{Oauth2AppType:m.Z},data(){return{form:{username:null,password:null},formRule:{username:[{required:!0,message:"请输入用户名或邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},oauthApps:[]}},created(){this.fetchAllOAuthApps()},methods:{resolveAppIcon(e){return e.appIcon&&""!=e.appIcon?e.appIcon:"github"==e.appType?n(39710):"gitlab"==e.appType?n(84386):""},fetchAllOAuthApps(){(0,f.aF)().then((e=>{e.errCode||(this.oauthApps=e.data)}))},toIndexPage(){this.$router.push({path:"/groups"})},onAuthLogin(e){const t=window.location.protocol,n=t+"//"+window.location.host+"/login/oauth2/"+e,a={redirect_uri:n};(0,f.nK)(e,a).then((e=>{e.errCode||(window.location.href=e.data)}))},onLogin(){this.$refs.formRef.validate((e=>{e&&(0,c.x4)(this.form).then((e=>{e.errCode||(d.E.saveUserLoginData(e.data),this.$store.commit("userUpdate",{nickname:e.data.nickname,username:e.data.username,email:e.data.email}),this.toIndexPage())}))}))}}},h=n(83744);const w=(0,h.Z)(g,[["render",s]]);var y=w},39710:function(e,t,n){e.exports=n.p+"img/github.e45f4724.svg"},84386:function(e,t,n){e.exports=n.p+"img/gitlab.6b1155ee.svg"},51457:function(e,t,n){e.exports=n.p+"img/wework.aaf3f725.svg"}}]);
//# sourceMappingURL=770.76b74074.js.map