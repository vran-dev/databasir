"use strict";(self["webpackChunkdatabasir"]=self["webpackChunkdatabasir"]||[]).push([[282],{75621:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var _api_OAuthApp__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(38787),_components_Oauth2AppType_vue__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(63766);__webpack_exports__["Z"]={components:{Oauth2AppType:_components_Oauth2AppType_vue__WEBPACK_IMPORTED_MODULE_1__.Z},data(){return{appPageData:{data:[],number:1,size:10,totalElements:0,totalPages:0},appPageQuery:{page:0,size:10,appNameContains:null,appType:null},isShowEditAppDialog:!1,redirectUri:"",appFormData:{id:null},appFormDataRule:{registrationId:[{required:!0,message:"请为应用配置唯一 ID",trigger:"blur"}],appName:[{required:!0,message:"请输入应用名称",trigger:"blur"}],appType:[{required:!0,message:"请选择应用类型",trigger:"blur"}],authUrl:[{required:!0,message:"请配置请求授权地址",trigger:"blur"}],resourceUrl:[{required:!0,message:"请配置资源 API 地址",trigger:"blur"}],clientId:[{required:!0,message:"请配置申请的 clientId",trigger:"blur"}],clientSecret:[{required:!0,message:"请配置申请的 clientSecret",trigger:"blur"}]},appTypes:[],platforms:[],selectedPlatform:{}}},created(){this.redirectUri=window.location.protocol+"//"+window.location.host+"/login/oauth2/",this.fetchPlatforms(),this.onAppCurrentPageChange(1)},methods:{fetchApps(e){e&&(this.appPageQuery.page=e-1),""==this.appPageQuery.appType&&(this.appPageQuery.appType=null),(0,_api_OAuthApp__WEBPACK_IMPORTED_MODULE_0__.Hj)(this.appPageQuery).then((e=>{e.errCode||(this.appPageData.data=e.data.content,this.appPageData.number=e.data.number+1,this.appPageData.size=e.data.size,this.appPageData.totalPages=e.data.totalPages,this.appPageData.totalElements=e.data.totalElements)}))},fetchPlatforms(){(0,_api_OAuthApp__WEBPACK_IMPORTED_MODULE_0__.ec)().then((e=>{e.errCode||(this.platforms=e.data,this.appTypes=e.data.map((e=>({type:e.authAppType,name:e.authAppName}))))}))},onAppCurrentPageChange(e){e&&this.fetchApps(e-1)},onQuery(){this.fetchApps()},onAppEdit(e){(0,_api_OAuthApp__WEBPACK_IMPORTED_MODULE_0__.FO)(e.id).then((e=>{e.errCode||(this.appFormData=e.data,this.onAppTypeChange(),this.isShowEditAppDialog=!0)}))},onAppCreate(){this.appFormData={},this.selectedPlatform={},this.isShowEditAppDialog=!0},onDelete(e){this.$confirm("确认删除该 APP 登录方式吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,_api_OAuthApp__WEBPACK_IMPORTED_MODULE_0__.Jp)(e.id).then((e=>{e.errCode||(this.$message.success("删除成功"),this.fetchApps())}))}))},onAppSave(){this.$refs.appFormDataRef.validate((e=>{e?(this.appFormData.properties=this.selectedPlatform.properties.map((e=>({name:e.name,value:e.value}))),this.appFormData.id?(0,_api_OAuthApp__WEBPACK_IMPORTED_MODULE_0__.KT)(this.appFormData).then((e=>{e.errCode||(this.$message.success("更新成功"),this.isShowEditAppDialog=!1,this.fetchApps())})):(0,_api_OAuthApp__WEBPACK_IMPORTED_MODULE_0__.ri)(this.appFormData).then((e=>{e.errCode||(this.$message.success("创建成功"),this.isShowEditAppDialog=!1,this.fetchApps())}))):this.$message.error("请填写表单必填项")}))},onAppTypeChange(){const currentAppType=this.appFormData.appType;if(currentAppType){const formData=this.appFormData,selected=this.platforms.find((e=>e.authAppType==currentAppType));if(selected.properties.forEach((item=>{item.defaultValue&&item.defaultValue.startsWith("javaScript:")?item.value=eval(item.defaultValue.substr("javaScript:".length)):item.value=item.defaultValue})),this.appFormData.properties){const e=new Map(this.appFormData.properties.map((e=>[e.name,e])));selected.properties.forEach((a=>{a.value=a.defaultValue,e.has(a.name)&&(a.value=e.get(a.name).value)}))}this.selectedPlatform=selected}else this.selectedPlatform={}}}}},38787:function(e,a,t){t.d(a,{aF:function(){return r},nK:function(){return o},Hj:function(){return i},Jp:function(){return u},FO:function(){return s},ri:function(){return m},KT:function(){return d},ec:function(){return _}});var p=t(63872);const l="/oauth2",r=()=>p.Z.get(l+"/apps"),o=(e,a)=>p.Z.get(l+"/authorization/"+e,{params:a}),n="/api/v1.0/oauth2_apps",i=e=>p.Z.get(n,{params:e}),u=e=>p.Z["delete"](n+"/"+e),s=e=>p.Z.get(n+"/"+e),m=e=>p.Z.post(n,e),d=e=>p.Z.patch(n,e),_=()=>p.Z.get(n+"/platforms")},63766:function(e,a,t){t.d(a,{Z:function(){return d}});var p=t(66252),l=t(3577);const r=["src"],o=["src"],n=["src"];function i(e,a,i,u,s,m){const d=(0,p.up)("el-tooltip");return"github"==i.appType.toLowerCase()?((0,p.wg)(),(0,p.j4)(d,{key:0,content:i.appName,effect:"light"},{default:(0,p.w5)((()=>[(0,p._)("img",{src:i.appIcon?i.appIcon:t(39710),style:{"max-width":"20px","max-height":"20px"}},null,8,r)])),_:1},8,["content"])):"gitlab"==i.appType.toLowerCase()?((0,p.wg)(),(0,p.j4)(d,{key:1,content:i.appName,effect:"light"},{default:(0,p.w5)((()=>[(0,p._)("img",{src:i.appIcon?i.appIcon:t(84386),style:{"max-width":"20px","max-height":"20px"}},null,8,o)])),_:1},8,["content"])):"we_work"==i.appType.toLowerCase()?((0,p.wg)(),(0,p.j4)(d,{key:2,content:i.appName,effect:"light"},{default:(0,p.w5)((()=>[(0,p._)("img",{src:i.appIcon?i.appIcon:t(51457),style:{"max-width":"20px","max-height":"20px"}},null,8,n)])),_:1},8,["content"])):((0,p.wg)(),(0,p.iD)(p.HY,{key:3},[(0,p.Uk)((0,l.zw)(i.appType),1)],64))}var u={props:{appType:String,appIcon:String,appName:String}},s=t(83744);const m=(0,s.Z)(u,[["render",i]]);var d=m},38282:function(e,a,t){t.r(a),t.d(a,{default:function(){return w}});var p=t(66252),l=t(3577);const r={style:{"margin-left":"12px"}},o=(0,p.Uk)(" 应用 ID "),n=(0,p.Uk)(" 应用类型 "),i=(0,p.Uk)(" 创建时间 "),u={style:{"margin-top":"20px"}},s=(0,p.Uk)(" 编辑 "),m=(0,p.Uk)(" 删除 "),d=(0,p.Uk)("保存"),_=(0,p.Uk)("取消");function c(e,a,t,c,g,h){const f=(0,p.up)("el-button"),w=(0,p.up)("el-tooltip"),y=(0,p.up)("el-col"),D=(0,p.up)("el-input"),A=(0,p.up)("el-option"),P=(0,p.up)("el-select"),W=(0,p.up)("el-divider"),C=(0,p.up)("el-row"),b=(0,p.up)("oauth2-app-type"),T=(0,p.up)("el-descriptions-item"),k=(0,p.up)("el-tag"),E=(0,p.up)("el-descriptions"),v=(0,p.up)("el-space"),x=(0,p.up)("el-card"),U=(0,p.up)("el-empty"),O=(0,p.up)("el-form-item"),I=(0,p.up)("info-filled"),F=(0,p.up)("el-icon"),V=(0,p.up)("el-link"),z=(0,p.up)("el-form"),M=(0,p.up)("el-dialog"),S=(0,p.up)("el-main"),K=(0,p.up)("el-pagination"),N=(0,p.up)("el-footer"),R=(0,p.up)("el-container");return(0,p.wg)(),(0,p.j4)(R,null,{default:(0,p.w5)((()=>[(0,p.Wm)(S,null,{default:(0,p.w5)((()=>[(0,p.Wm)(C,{gutter:12},{default:(0,p.w5)((()=>[(0,p.Wm)(y,{xs:24,sm:6,md:6,lg:3,xl:3},{default:(0,p.w5)((()=>[(0,p.Wm)(w,{content:"创建应用",placement:"top"},{default:(0,p.w5)((()=>[(0,p.Wm)(f,{type:"primary",icon:"plus",style:{width:"100%"},onClick:a[0]||(a[0]=e=>h.onAppCreate())})])),_:1})])),_:1}),(0,p.Wm)(y,{xs:24,sm:10,md:10,lg:6,xl:4},{default:(0,p.w5)((()=>[(0,p.Wm)(D,{onChange:h.onQuery,modelValue:g.appPageQuery.appNameContains,"onUpdate:modelValue":a[1]||(a[1]=e=>g.appPageQuery.appNameContains=e),label:"应用名称",placeholder:"应用名称搜素","prefix-icon":"search"},null,8,["onChange","modelValue"])])),_:1}),(0,p.Wm)(y,{xs:24,sm:8,md:8,lg:6,xl:4},{default:(0,p.w5)((()=>[(0,p.Wm)(P,{modelValue:g.appPageQuery.appType,"onUpdate:modelValue":a[2]||(a[2]=e=>g.appPageQuery.appType=e),placeholder:"应用类型",onChange:h.onQuery,clearable:"",style:{width:"100%"}},{default:(0,p.w5)((()=>[((0,p.wg)(!0),(0,p.iD)(p.HY,null,(0,p.Ko)(g.appTypes,(e=>((0,p.wg)(),(0,p.j4)(A,{key:e,label:e.name,value:e.type},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,p.Wm)(y,{span:24},{default:(0,p.w5)((()=>[(0,p.Wm)(W)])),_:1})])),_:1}),(0,p.Wm)(C,{gutter:33},{default:(0,p.w5)((()=>[((0,p.wg)(!0),(0,p.iD)(p.HY,null,(0,p.Ko)(g.appPageData.data,(a=>((0,p.wg)(),(0,p.j4)(y,{xs:24,sm:24,md:12,lg:8,xl:6,key:a.id},{default:(0,p.w5)((()=>[(0,p.Wm)(x,{shadow:"hover"},{default:(0,p.w5)((()=>[(0,p.Wm)(W,{"content-position":"left"},{default:(0,p.w5)((()=>[(0,p.Wm)(b,{"app-type":a.appType,"app-name":a.appName},null,8,["app-type","app-name"]),(0,p._)("span",r,(0,l.zw)(a.appName),1)])),_:2},1024),(0,p._)("div",null,[(0,p.Wm)(E,{column:1,size:e.size,border:""},{default:(0,p.w5)((()=>[(0,p.Wm)(T,{label:"appId"},{label:(0,p.w5)((()=>[o])),default:(0,p.w5)((()=>[(0,p.Uk)(" "+(0,l.zw)(a.registrationId),1)])),_:2},1024),(0,p.Wm)(T,{label:"appType"},{label:(0,p.w5)((()=>[n])),default:(0,p.w5)((()=>[(0,p.Wm)(k,null,{default:(0,p.w5)((()=>[(0,p.Uk)((0,l.zw)(a.appType),1)])),_:2},1024)])),_:2},1024),(0,p.Wm)(T,{label:"创建时间"},{label:(0,p.w5)((()=>[i])),default:(0,p.w5)((()=>[(0,p.Uk)(" "+(0,l.zw)(a.createAt),1)])),_:2},1024)])),_:2},1032,["size"])]),(0,p._)("div",u,[(0,p.Wm)(v,null,{default:(0,p.w5)((()=>[(0,p.Wm)(f,{type:"primary",size:"small",icon:"Edit",onClick:e=>h.onAppEdit(a)},{default:(0,p.w5)((()=>[s])),_:2},1032,["onClick"]),(0,p.Wm)(f,{type:"danger",onClick:e=>h.onDelete(a),size:"small",icon:"Delete"},{default:(0,p.w5)((()=>[m])),_:2},1032,["onClick"])])),_:2},1024)])])),_:2},1024)])),_:2},1024)))),128))])),_:1}),0==g.appPageData.data.length?((0,p.wg)(),(0,p.j4)(U,{key:0,"image-size":200,description:"暂无数据"})):(0,p.kq)("",!0),(0,p.Wm)(M,{modelValue:g.isShowEditAppDialog,"onUpdate:modelValue":a[9]||(a[9]=e=>g.isShowEditAppDialog=e),width:"38%",center:"","destroy-on-close":""},{default:(0,p.w5)((()=>[(0,p.Wm)(z,{model:g.appFormData,rules:g.appFormDataRule,ref:"appFormDataRef","label-position":"top"},{default:(0,p.w5)((()=>[(0,p.Wm)(C,{gutter:28},{default:(0,p.w5)((()=>[(0,p.Wm)(y,{xs:24,sm:24,md:12,lg:10},{default:(0,p.w5)((()=>[(0,p.Wm)(O,{label:"应用 ID",prop:"registrationId"},{default:(0,p.w5)((()=>[(0,p.Wm)(D,{modelValue:g.appFormData.registrationId,"onUpdate:modelValue":a[3]||(a[3]=e=>g.appFormData.registrationId=e),placeholder:"建议输入全英文字符"},null,8,["modelValue"])])),_:1})])),_:1}),(0,p.Wm)(y,{xs:24,sm:24,md:12,lg:10},{default:(0,p.w5)((()=>[(0,p.Wm)(O,{label:"应用名称",prop:"appName"},{default:(0,p.w5)((()=>[(0,p.Wm)(D,{modelValue:g.appFormData.appName,"onUpdate:modelValue":a[4]||(a[4]=e=>g.appFormData.appName=e),placeholder:"用户可理解的登陆应用名"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,p.Wm)(O,{label:"应用类型",prop:"appName"},{default:(0,p.w5)((()=>[(0,p.Wm)(P,{modelValue:g.appFormData.appType,"onUpdate:modelValue":a[5]||(a[5]=e=>g.appFormData.appType=e),placeholder:"请选择应用类型",size:"default",onChange:a[6]||(a[6]=e=>h.onAppTypeChange())},{default:(0,p.w5)((()=>[((0,p.wg)(!0),(0,p.iD)(p.HY,null,(0,p.Ko)(g.appTypes,(e=>((0,p.wg)(),(0,p.j4)(A,{key:e,label:e.name,value:e.type},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,p.Wm)(C,{gutter:28},{default:(0,p.w5)((()=>[((0,p.wg)(!0),(0,p.iD)(p.HY,null,(0,p.Ko)(g.selectedPlatform.properties,(e=>((0,p.wg)(),(0,p.j4)(y,{xs:24,sm:24,md:12,lg:10,key:e.authAppType},{default:(0,p.w5)((()=>[(0,p.Wm)(O,{label:e.label,prop:e.name},{default:(0,p.w5)((()=>[(0,p.Wm)(D,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,placeholder:e.description},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label","prop"])])),_:2},1024)))),128))])),_:1}),(0,p.Wm)(C,{style:{"margin-bottom":"33px"}},{default:(0,p.w5)((()=>[(0,p.Wm)(y,null,{default:(0,p.w5)((()=>[(0,p.Wm)(W,null,{default:(0,p.w5)((()=>[(0,p.Wm)(F,{color:"#000"},{default:(0,p.w5)((()=>[(0,p.Wm)(I)])),_:1}),(0,p.Uk)(" 请在 "+(0,l.zw)(g.appFormData.appType)+" 中配置回调地址 ",1)])),_:1}),(0,p.Wm)(V,{type:"primary"},{default:(0,p.w5)((()=>[(0,p.Uk)((0,l.zw)(g.redirectUri)+(0,l.zw)(g.appFormData.registrationId),1)])),_:1})])),_:1})])),_:1}),(0,p.Wm)(O,null,{default:(0,p.w5)((()=>[(0,p.Wm)(f,{type:"primary",onClick:a[7]||(a[7]=e=>h.onAppSave("groupFormRef"))},{default:(0,p.w5)((()=>[d])),_:1}),(0,p.Wm)(f,{onClick:a[8]||(a[8]=e=>g.isShowEditAppDialog=!1)},{default:(0,p.w5)((()=>[_])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])),_:1}),(0,p.Wm)(N,null,{default:(0,p.w5)((()=>[(0,p.Wm)(K,{layout:"prev, pager, next","hide-on-single-page":!1,currentPage:g.appPageData.number,"page-size":g.appPageData.size,"page-count":g.appPageData.totalPages,onCurrentChange:h.onAppCurrentPageChange},null,8,["currentPage","page-size","page-count","onCurrentChange"])])),_:1})])),_:1})}var g=t(75621),h=t(83744);const f=(0,h.Z)(g.Z,[["render",c]]);var w=f},39710:function(e,a,t){e.exports=t.p+"img/github.e45f4724.svg"},84386:function(e,a,t){e.exports=t.p+"img/gitlab.6b1155ee.svg"},51457:function(e,a,t){e.exports=t.p+"img/wework.aaf3f725.svg"}}]);
//# sourceMappingURL=282.1f2c08ec.js.map