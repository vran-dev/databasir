"use strict";(self["webpackChunkdatabasir"]=self["webpackChunkdatabasir"]||[]).push([[596],{8337:function(e,t,a){a.d(t,{Wq:function(){return n},ex:function(){return u},vB:function(){return l},iE:function(){return p},yF:function(){return c},E2:function(){return d},_j:function(){return g},q9:function(){return m}});var o=a(3872);const r="/api/v1.0/groups",n=e=>o.Z.get(r,{params:e}),u=e=>o.Z.get(r+"/"+e),l=e=>e.id&&null!=e.id?s(e):i(e),i=e=>o.Z.post(r,e),s=e=>o.Z.patch(r,e),p=e=>o.Z["delete"](r+"/"+e),c=(e,t)=>o.Z.get(r+"/"+e+"/members",{params:t}),d=(e,t)=>o.Z.post(r+"/"+e+"/members",t),g=(e,t)=>o.Z["delete"](r+"/"+e+"/members/"+t),m=(e,t,a)=>{const n={role:a};return o.Z.patch(r+"/"+e+"/members/"+t,n)}},9324:function(e,t,a){a.d(t,{hW:function(){return n},Rp:function(){return u},Iu:function(){return l},M7:function(){return s},jI:function(){return d}});var o=a(3872);const r="/api/v1.0/projects",n=e=>o.Z.get(r,{params:e}),u=e=>o.Z.get(r+"/"+e),l=e=>e.id?c(e):i(e),i=e=>o.Z.post(r,e),s=e=>o.Z.post(r+"/test_connection",e),p="/api/v1.0/groups",c=e=>o.Z.patch(p+"/"+e.groupId+"/projects",e),d=(e,t)=>o.Z["delete"](p+"/"+e+"/projects/"+t)},3110:function(e,t,a){a.d(t,{yw:function(){return n},Dx:function(){return u},B9:function(){return l},__:function(){return i},r4:function(){return s},oD:function(){return p},_:function(){return c},Uz:function(){return d},gQ:function(){return g},Gz:function(){return m}});var o=a(3872);const r="/api/v1.0/users",n=e=>o.Z.get(r,{params:e}),u=e=>o.Z.post(r+"/"+e+"/enable"),l=e=>o.Z.post(r+"/"+e+"/disable"),i=e=>o.Z.get(r+"/"+e),s=e=>o.Z.post(r,e),p=e=>o.Z.post(r+"/"+e+"/renew_password"),c=e=>o.Z.post(r+"/"+e+"/sys_owners"),d=e=>o.Z["delete"](r+"/"+e+"/sys_owners"),g=(e,t)=>o.Z.post(r+"/"+e+"/password",t),m=(e,t)=>o.Z.post(r+"/"+e+"/nickname",t)},9080:function(e,t,a){a.d(t,{V$:function(){return n},Ni:function(){return u},a3:function(){return l}});var o=a(3872);const r="/api/v1.0/user_projects/favorites",n=e=>o.Z.get(r,{params:e}),u=e=>o.Z["delete"](r+"/"+e),l=e=>o.Z.post(r+"/"+e)},7596:function(e,t,a){a.r(t),a.d(t,{default:function(){return G}});var o=a(6252),r=a(9963),n=a(3577);const u=["onClick"],l={style:{color:"#909399","font-size":"13px"}},i={style:{color:"#909399"}},s={key:1},p=(0,o.Uk)(" 更多 "),c=(0,o.Uk)("查看文档"),d=(0,o.Uk)("取消关注"),g=(0,o.Uk)("删除项目"),m=(0,o._)("h2",null,"组长管理",-1),w=(0,o.Uk)("保存"),f=(0,o.Uk)("取消"),h=(0,o.Uk)("删除分组"),_=(0,o.Uk)("确认删除分组");function W(e,t,a,W,D,y){const P=(0,o.up)("el-button"),b=(0,o.up)("el-tooltip"),k=(0,o.up)("el-col"),v=(0,o.up)("el-input"),C=(0,o.up)("el-row"),j=(0,o.up)("el-empty"),G=(0,o.up)("el-link"),O=(0,o.up)("el-divider"),E=(0,o.up)("user"),z=(0,o.up)("el-icon"),U=(0,o.up)("el-tag"),Z=(0,o.up)("arrow-down"),N=(0,o.up)("el-dropdown-item"),V=(0,o.up)("el-dropdown-menu"),I=(0,o.up)("el-dropdown"),S=(0,o.up)("el-space"),T=(0,o.up)("folder"),R=(0,o.up)("el-card"),F=(0,o.up)("el-main"),$=(0,o.up)("el-pagination"),Q=(0,o.up)("el-footer"),q=(0,o.up)("el-container"),x=(0,o.up)("el-tab-pane"),A=(0,o.up)("el-table-column"),L=(0,o.up)("database-icon"),Y=(0,o.up)("el-table"),M=(0,o.up)("el-tabs"),B=(0,o.up)("el-form-item"),H=(0,o.up)("el-autocomplete"),K=(0,o.up)("el-form"),J=(0,o.up)("warning-filled"),X=(0,o.up)("el-collapse-item"),ee=(0,o.up)("el-collapse"),te=(0,o.up)("el-dialog"),ae=(0,o.Q2)("require-roles");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(M,{modelValue:y.activeTab,"onUpdate:modelValue":t[3]||(t[3]=e=>y.activeTab=e),onTabClick:y.onTabClick},{default:(0,o.w5)((()=>[(0,o.Wm)(x,{label:"项目分组",name:"groupListTab"},{default:(0,o.w5)((()=>[(0,o.Wm)(q,null,{default:(0,o.w5)((()=>[(0,o.Wm)(F,null,{default:(0,o.w5)((()=>[(0,o.Wm)(C,{gutter:12},{default:(0,o.w5)((()=>[(0,o.wy)(((0,o.wg)(),(0,o.j4)(k,{span:3},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{content:"创建一个分组",placement:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{type:"primary",icon:"plus",style:{width:"100%"},onClick:t[0]||(t[0]=e=>y.toCreatePage())})])),_:1})])),_:1})),[[ae,["SYS_OWNER"]]]),(0,o.Wm)(k,{span:8},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{onChange:y.onQuery,modelValue:D.groupPageQuery.groupNameContains,"onUpdate:modelValue":t[1]||(t[1]=e=>D.groupPageQuery.groupNameContains=e),label:"组名",placeholder:"组名称搜索","prefix-icon":"search"},null,8,["onChange","modelValue"])])),_:1})])),_:1}),0==D.groupPageData.data.length?((0,o.wg)(),(0,o.j4)(C,{key:0},{default:(0,o.w5)((()=>[(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[(0,o.Wm)(j,{description:"请先创建分组"})])),_:1})])),_:1})):((0,o.wg)(!0),(0,o.iD)(o.HY,{key:1},(0,o.Ko)(y.partitionArray(4,D.groupPageData.data),((e,a)=>((0,o.wg)(),(0,o.j4)(C,{gutter:20,key:a},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e,(e=>((0,o.wg)(),(0,o.j4)(k,{span:6,key:e.id},{default:(0,o.w5)((()=>[(0,o.Wm)(R,{shadow:"hover",onMouseenter:t=>D.mouseEnterGroupId=e.id,onMouseleave:t[2]||(t[2]=e=>D.mouseEnterGroupId=null)},{default:(0,o.w5)((()=>[(0,o.Wm)(O,{"content-position":"right"},{default:(0,o.w5)((()=>[(0,o.wy)((0,o.Wm)(G,{underline:!1,onClick:t=>y.toEditPage(e.id,e.name),icon:"Edit",style:{"margin-right":"8px"}},null,8,["onClick"]),[[r.F8,e.id==D.mouseEnterGroupId],[ae,["SYS_OWNER","GROUP_OWNER?groupId="+e.id]]]),(0,o.Wm)(G,{underline:!1},{default:(0,o.w5)((()=>[(0,o._)("span",{onClick:t=>y.toGroupDashboard(e.id,e.name)},[(0,o._)("h4",null,(0,n.zw)(e.name),1)],8,u)])),_:2},1024)])),_:2},1024),(0,o.Wm)(S,{direction:"vertical",alignment:"stretch",size:16},{default:(0,o.w5)((()=>[(0,o._)("span",l,(0,n.zw)(e.description),1),(0,o.Wm)(S,{wrap:""},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{content:"组长"},{default:(0,o.w5)((()=>[(0,o.Wm)(z,{color:"#909399"},{default:(0,o.w5)((()=>[(0,o.Wm)(E)])),_:1})])),_:1}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.groupOwnerNames.slice(0,2),((e,t)=>((0,o.wg)(),(0,o.j4)(U,{key:t,type:"info"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e),1)])),_:2},1024)))),128)),e.groupOwnerNames.length>2?((0,o.wg)(),(0,o.j4)(I,{key:0},{dropdown:(0,o.w5)((()=>[(0,o.Wm)(V,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.groupOwnerNames.slice(3),((e,t)=>((0,o.wg)(),(0,o.j4)(N,{key:t},{default:(0,o.w5)((()=>[(0,o.Wm)(U,{type:"info"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),default:(0,o.w5)((()=>[(0,o.Wm)(z,{class:"el-icon--right"},{default:(0,o.w5)((()=>[(0,o.Wm)(Z)])),_:1})])),_:2},1024)):(0,o.kq)("",!0)])),_:2},1024),(0,o.Wm)(S,{wrap:""},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{content:"项目数"},{default:(0,o.w5)((()=>[(0,o.Wm)(z,{color:"#909399"},{default:(0,o.w5)((()=>[(0,o.Wm)(T)])),_:1})])),_:1}),(0,o._)("span",i,(0,n.zw)(e.projectCount),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onMouseenter"])])),_:2},1024)))),128))])),_:2},1024)))),128))])),_:1}),(0,o.Wm)(Q,null,{default:(0,o.w5)((()=>[(0,o.Wm)($,{layout:"prev, pager, next","hide-on-single-page":!1,currentPage:D.groupPageData.number,"page-size":D.groupPageData.size,"page-count":D.groupPageData.totalPages,onCurrentChange:y.onPageChange},null,8,["currentPage","page-size","page-count","onCurrentChange"])])),_:1})])),_:1})])),_:1}),(0,o.Wm)(x,{label:"关注项目",name:"favoriteProjectListTab"},{default:(0,o.w5)((()=>[(0,o.Wm)(q,null,{default:(0,o.w5)((()=>[(0,o.Wm)(F,null,{default:(0,o.w5)((()=>[(0,o.Wm)(Y,{data:D.favoriteProjectPageData.data,stripe:""},{default:(0,o.w5)((()=>[(0,o.Wm)(A,{prop:"projectId",label:"项目 ID"}),(0,o.Wm)(A,{prop:"projectName",label:"项目名称"},{default:(0,o.w5)((e=>[(0,o.Wm)(G,{onClick:t=>y.toDocumentPage(e.row)},{default:(0,o.w5)((()=>[(0,o._)("span",null,(0,n.zw)(e.row.projectName),1)])),_:2},1032,["onClick"])])),_:1}),(0,o.Wm)(A,{prop:"projectDescription",label:"项目描述"}),(0,o.Wm)(A,{label:"定时同步",align:"center"},{default:(0,o.w5)((e=>[e.row.isAutoSync?((0,o.wg)(),(0,o.j4)(U,{key:0},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e.row.autoSyncCron),1)])),_:2},1024)):((0,o.wg)(),(0,o.iD)("span",s," 无 "))])),_:1}),(0,o.Wm)(A,{label:"数据库类型"},{default:(0,o.w5)((e=>[(0,o.Wm)(L,{databaseType:e.row.databaseType},null,8,["databaseType"])])),_:1}),(0,o.Wm)(A,{prop:"databaseName",label:"数据库名称"}),(0,o.Wm)(A,{prop:"groupName",label:"所属分组"},{default:(0,o.w5)((e=>[(0,o.Wm)(G,{onClick:t=>y.toGroupDashboard(e.row.groupId,e.row.groupName),icon:"List"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e.row.groupName),1)])),_:2},1032,["onClick"])])),_:1}),(0,o.Wm)(A,{prop:"createAt",label:"关注时间"}),(0,o.Wm)(A,{label:"操作"},{default:(0,o.w5)((t=>[(0,o.Wm)(I,null,{dropdown:(0,o.w5)((()=>[(0,o.Wm)(V,null,{default:(0,o.w5)((()=>[(0,o.Wm)(N,null,{default:(0,o.w5)((()=>[(0,o.Wm)(P,{type:"primary",size:"small",onClick:(0,r.iM)((e=>y.toDocumentPage(t.row)),["stop"]),icon:"View"},{default:(0,o.w5)((()=>[c])),_:2},1032,["onClick"])])),_:2},1024),(0,o.Wm)(N,null,{default:(0,o.w5)((()=>[(0,o.Wm)(P,{type:"warning",size:"small",onClick:(0,r.iM)((e=>y.onRemoveFavorite(t.row.projectId)),["stop"]),icon:"StarFilled"},{default:(0,o.w5)((()=>[d])),_:2},1032,["onClick"])])),_:2},1024),(0,o.wy)(((0,o.wg)(),(0,o.j4)(N,null,{default:(0,o.w5)((()=>[(0,o.Wm)(P,{type:"danger",size:"small",onClick:(0,r.iM)((e=>y.onProjectDelete(t.row.projectId)),["stop"]),icon:"Remove"},{default:(0,o.w5)((()=>[g])),_:2},1032,["onClick"])])),_:2},1024)),[[ae,["SYS_OWNER","GROUP_OWNER?groupId="+e.groupId]]])])),_:2},1024)])),default:(0,o.w5)((()=>[(0,o._)("span",null,[p,(0,o.Wm)(z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(Z)])),_:1})])])),_:2},1024)])),_:1})])),_:1},8,["data"])])),_:1}),(0,o.Wm)(Q,null,{default:(0,o.w5)((()=>[(0,o.Wm)($,{layout:"prev, pager, next","hide-on-single-page":!1,currentPage:D.favoriteProjectPageData.number,"page-size":D.favoriteProjectPageData.size,"page-count":D.favoriteProjectPageData.totalPages,onCurrentChange:y.onFavoriteProjectPageChange},null,8,["currentPage","page-size","page-count","onCurrentChange"])])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","onTabClick"]),(0,o.Wm)(te,{modelValue:D.isShowEditGroupDialog,"onUpdate:modelValue":t[10]||(t[10]=e=>D.isShowEditGroupDialog=e),width:"38%",center:"","destroy-on-close":""},{default:(0,o.w5)((()=>[(0,o.Wm)(K,{model:D.groupData,rules:D.groupDataRule,ref:"groupFormRef","label-position":"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(B,{label:"名称",prop:"name"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{modelValue:D.groupData.name,"onUpdate:modelValue":t[4]||(t[4]=e=>D.groupData.name=e)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(B,{label:"描述",prop:"description"},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{modelValue:D.groupData.description,"onUpdate:modelValue":t[5]||(t[5]=e=>D.groupData.description=e),type:"textarea"},null,8,["modelValue"])])),_:1}),m,(0,o.Wm)(B,null,{default:(0,o.w5)((()=>[(0,o.Wm)(H,{modelValue:D.userQueryData.nicknameOrUsernameOrEmailContains,"onUpdate:modelValue":t[6]||(t[6]=e=>D.userQueryData.nicknameOrUsernameOrEmailContains=e),"fetch-suggestions":y.queryUsersAsync,placeholder:"用户名、昵称或邮箱搜索",onSelect:y.onGroupOwnerSelect,clearable:""},null,8,["modelValue","fetch-suggestions","onSelect"])])),_:1}),(0,o.Wm)(B,null,{default:(0,o.w5)((()=>[(0,o.Wm)(S,{wrap:""},{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(D.groupData.groupOwners,((e,t)=>((0,o.wg)(),(0,o.j4)(U,{key:e.id,type:"primary",size:"large",closable:"","disable-transitions":!1,onClose:e=>y.onGroupOwnerRemove(t)},{default:(0,o.w5)((()=>[(0,o.Wm)(b,{content:e.email,placement:"top"},{default:(0,o.w5)((()=>[(0,o._)("span",null,(0,n.zw)(e.nickname),1)])),_:2},1032,["content"])])),_:2},1032,["onClose"])))),128))])),_:1})])),_:1}),(0,o.Wm)(B,null,{default:(0,o.w5)((()=>[(0,o.Wm)(P,{type:"primary",onClick:t[7]||(t[7]=e=>y.onGroupSave("groupFormRef"))},{default:(0,o.w5)((()=>[w])),_:1}),(0,o.Wm)(P,{onClick:t[8]||(t[8]=e=>D.isShowEditGroupDialog=!1)},{default:(0,o.w5)((()=>[f])),_:1})])),_:1})])),_:1},8,["model","rules"]),D.groupData.id?((0,o.wg)(),(0,o.j4)(ee,{key:0},{default:(0,o.w5)((()=>[(0,o.Wm)(X,{name:"1"},{title:(0,o.w5)((()=>[(0,o.Wm)(z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(J)])),_:1}),h])),default:(0,o.w5)((()=>[(0,o.Wm)(b,{content:"数据一旦删除将无法恢复，谨慎操作",placement:"top"},{default:(0,o.w5)((()=>[(0,o.Wm)(P,{icon:"delete",size:"large",style:{width:"100%",margin:"0 auto"},onClick:t[9]||(t[9]=e=>y.onGroupDelete(D.groupData.id))},{default:(0,o.w5)((()=>[_])),_:1})])),_:1})])),_:1})])),_:1})):(0,o.kq)("",!0)])),_:1},8,["modelValue"])],64)}var D=a(8337),y=a(3110),P=a(9080),b=a(9324),k=a(1836),v={data(){return{isShowEditGroupDialog:!1,mouseEnterGroupId:null,groupData:{groupOwners:[]},groupDataRule:{name:[this.requiredInputValidRule("请输入有效昵称")],description:[this.requiredInputValidRule("请输入有效邮箱")]},userQueryData:{nicknameContains:null,nicknameOrUsernameOrEmailContains:null,size:50},groupPageData:{data:[],number:1,size:15,totalElements:0,totalPages:1},groupPageQuery:{page:0,size:15,groupNameContains:null},favoriteProjectPageData:{data:[],number:1,size:15,totalElements:0,totalPages:1},favoriteProjectPageQuery:{page:0,size:20,projectNameContains:null}}},created(){this.fetchGroupsFunction(),this.fetchUserFavorites()},computed:{activeTab:{get(){return this.$store.state.groupListActiveTab?this.$store.state.groupListActiveTab:(this.$store.commit("switchGroupListActiveTab","groupListTab"),"groupListTab")},set(e){this.$store.commit("switchGroupListActiveTab",e)}}},methods:{isPermit(e){return k.E.hasAnyRoles([e])},async fetchUserFavorites(){const e=await(0,P.V$)(this.favoriteProjectPageQuery);this.favoriteProjectPageData.data=e.data.content,this.favoriteProjectPageData.number=e.data.number+1,this.favoriteProjectPageData.size=e.data.size,this.favoriteProjectPageData.totalPages=e.data.totalPages,this.favoriteProjectPageData.totalElements=e.data.totalElements},async fetchGroupsFunction(){const e=await(0,D.Wq)(this.groupPageQuery);this.groupPageData.data=e.data.content,this.groupPageData.number=e.data.number+1,this.groupPageData.size=e.data.size,this.groupPageData.totalPages=e.data.totalPages,this.groupPageData.totalElements=e.data.totalElements},requiredInputValidRule(e){return{required:!0,message:e,trigger:"blur"}},requiredGroupOwners(){return!(null==this.groupData.groupOwners||this.groupData.groupOwners.length<1||this.groupData.groupOwners.length>20)},partitionArray(e,t){for(var a=[],o=0,r=0;r<t.length;r+=e)a[o++]=t.slice(r,r+e);return a},onPageChange(e){e&&(this.groupPageQuery.page=e-1,this.fetchGroupsFunction())},onQuery(){this.fetchGroupsFunction()},async queryUsersAsync(e,t){const a=await(0,y.yw)(this.userQueryData).then((e=>e.data.content)),o=a.map((e=>({value:e.nickname,nickname:e.nickname,email:e.email,id:e.id})));t(o)},onGroupDelete(e){this.$confirm("确认删除该分组？删除后数据将无法恢复","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,D.iE)(e).then((e=>{e.errCode||(this.$message.success("删除成功"),this.isShowEditGroupDialog=!1,this.fetchGroupsFunction())}))}))},onGroupSave(){this.requiredGroupOwners()?this.$refs.groupFormRef.validate((e=>{if(e){const e=Object.assign({},this.groupData);e.groupOwnerUserIds=this.groupData.groupOwners.map((e=>e.id)),(0,D.vB)(e).then((e=>{e.errCode||(this.$message.success("保存成功"),this.isShowEditGroupDialog=!1,this.groupData={groupOwners:[]},this.fetchGroupsFunction())}))}else this.$message.error("请填写表单必填项")})):this.$message.warning("组长人数至少需要 1 人，最多为 20 人")},onGroupOwnerRemove(e){this.groupData.groupOwners.splice(e,1)},onGroupOwnerSelect(e){this.groupData.groupOwners.some((t=>t.id==e.id))||this.groupData.groupOwners.push(e),this.userQueryData.nicknameOrUsernameOrEmailContains=null},toCreatePage(){this.isShowEditGroupDialog=!0,this.groupData={groupOwners:[]}},toEditPage(e){(0,D.ex)(e).then((e=>{e.errCode||(this.isShowEditGroupDialog=!0,this.groupData=e.data)}))},toGroupDashboard(e,t){this.$router.push({path:"/groups/"+e,query:{groupName:t}})},toGroupMemberListPage(){},toDocumentPage(e){const t=e.groupId,a=e.projectId;this.$router.push({path:"/groups/"+t+"/projects/"+a+"/documents",query:{projectName:e.projectName,groupName:e.groupName}})},onFavoriteProjectPageChange(e){e&&(this.favoriteProjectPageQuery.page=e-1,this.fetchUserFavorites())},onRemoveFavorite(e){(0,P.Ni)(e).then((e=>{e.errCode||(this.$message.success("成功取消"),this.fetchUserFavorites())}))},onProjectDelete(e){this.$confirm("确认删除该项目？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{(0,b.jI)(this.groupId,e).then((e=>{e.errCode||(this.$message.success("删除成功"),this.fetchUserFavorites())}))}))},onTabClick(e){this.$store.commit("switchGroupListActiveTab",e.props.name)}}},C=a(3744);const j=(0,C.Z)(v,[["render",W]]);var G=j}}]);
//# sourceMappingURL=596.c5d055fb.js.map