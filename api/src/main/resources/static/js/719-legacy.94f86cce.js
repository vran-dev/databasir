"use strict";(self["webpackChunkdatabasir_frontend"]=self["webpackChunkdatabasir_frontend"]||[]).push([[719],{3110:function(e,n,t){t.d(n,{yw:function(){return u},Dx:function(){return l},B9:function(){return o},__:function(){return i},r4:function(){return s},oD:function(){return d},_:function(){return c},Uz:function(){return f},gQ:function(){return m},Gz:function(){return p}});var r=t(3872),a="/api/v1.0/users",u=function(e){return r.Z.get(a,{params:e})},l=function(e){return r.Z.post(a+"/"+e+"/enable")},o=function(e){return r.Z.post(a+"/"+e+"/disable")},i=function(e){return r.Z.get(a+"/"+e)},s=function(e){return r.Z.post(a,e)},d=function(e){return r.Z.post(a+"/"+e+"/renew_password")},c=function(e){return r.Z.post(a+"/"+e+"/sys_owners")},f=function(e){return r.Z["delete"](a+"/"+e+"/sys_owners")},m=function(e,n){return r.Z.post(a+"/"+e+"/password",n)},p=function(e,n){return r.Z.post(a+"/"+e+"/nickname",n)}},9719:function(e,n,t){t.r(n),t.d(n,{default:function(){return h}});var r=t(6252),a=t(3577),u=t(9963),l=(0,r.Uk)("重置密码"),o=(0,r._)("br",null,null,-1),i=(0,r._)("h3",null,"角色信息",-1),s=(0,r.Uk)("保存"),d=(0,r.Uk)("取消");function c(e,n,t,c,f,m){var p=(0,r.up)("el-button"),w=(0,r.up)("el-tooltip"),g=(0,r.up)("el-col"),h=(0,r.up)("el-option"),b=(0,r.up)("el-select"),D=(0,r.up)("el-input"),W=(0,r.up)("el-row"),_=(0,r.up)("el-header"),U=(0,r.up)("el-table-column"),y=(0,r.up)("el-link"),C=(0,r.up)("el-switch"),V=(0,r.up)("el-table"),k=(0,r.up)("el-main"),P=(0,r.up)("el-pagination"),z=(0,r.up)("el-footer"),S=(0,r.up)("el-descriptions-item"),O=(0,r.up)("el-descriptions"),E=(0,r.up)("List"),R=(0,r.up)("el-icon"),v=(0,r.up)("el-drawer"),Q=(0,r.up)("el-form-item"),I=(0,r.up)("el-form"),Z=(0,r.up)("el-dialog"),x=(0,r.up)("el-container");return(0,r.wg)(),(0,r.j4)(x,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(_,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(W,{gutter:12},{default:(0,r.w5)((function(){return[(0,r.Wm)(g,{span:2},{default:(0,r.w5)((function(){return[(0,r.Wm)(w,{content:"创建新用户",placement:"top"},{default:(0,r.w5)((function(){return[(0,r.Wm)(p,{type:"primary",icon:"plus",style:{width:"100%"},onClick:n[0]||(n[0]=function(e){return m.toCreatePage()})})]})),_:1})]})),_:1}),(0,r.Wm)(g,{span:3},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{modelValue:f.userPageQuery.enabled,"onUpdate:modelValue":n[1]||(n[1]=function(e){return f.userPageQuery.enabled=e}),placeholder:"启用状态",onChange:m.onQuery,clearable:""},{default:(0,r.w5)((function(){return[((0,r.wg)(),(0,r.iD)(r.HY,null,(0,r.Ko)([!0,!1],(function(e){return(0,r.Wm)(h,{key:e,label:e?"启用":"禁用",value:e},null,8,["label","value"])})),64))]})),_:1},8,["modelValue","onChange"])]})),_:1}),(0,r.Wm)(g,{span:6},{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{onChange:m.onQuery,modelValue:f.userPageQuery.nicknameOrUsernameOrEmailContains,"onUpdate:modelValue":n[2]||(n[2]=function(e){return f.userPageQuery.nicknameOrUsernameOrEmailContains=e}),label:"用户名",placeholder:"昵称、用户名或邮箱搜索","prefix-icon":"search"},null,8,["onChange","modelValue"])]})),_:1})]})),_:1})]})),_:1}),(0,r.Wm)(k,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(V,{data:f.userPageData.content,border:"",width:"80%"},{default:(0,r.w5)((function(){return[(0,r.Wm)(U,{prop:"id",label:"ID","min-width":"60",fixed:"left"}),(0,r.Wm)(U,{prop:"nickname",label:"昵称","min-width":"120",fixed:"left",resizable:""}),(0,r.Wm)(U,{prop:"username",label:"用户名","min-width":"120",resizable:""}),(0,r.Wm)(U,{label:"邮箱",width:"200",resizable:""},{default:(0,r.w5)((function(e){return[(0,r.Wm)(y,{underline:!0,onClick:function(n){return m.onGetUserDetail(e.row)},type:"primary"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(e.row.email),1)]})),_:2},1032,["onClick"])]})),_:1}),(0,r.Wm)(U,{label:"启用状态",resizable:""},{default:(0,r.w5)((function(e){return[(0,r.Wm)(C,{modelValue:e.row.enabled,"onUpdate:modelValue":function(n){return e.row.enabled=n},loading:f.loading.userEnableLoading,onChange:function(n){return m.onSwitchEnabled(e.row.id,e.row.enabled)}},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]})),_:1}),(0,r.Wm)(U,{label:"系统管理员"},{default:(0,r.w5)((function(e){return[(0,r.Wm)(C,{modelValue:e.row.isSysOwner,"onUpdate:modelValue":function(n){return e.row.isSysOwner=n},loading:f.loading.sysOwnerLoading,onChange:function(n){return m.onChangeSysOwner(e.row)}},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]})),_:1}),(0,r.Wm)(U,{prop:"createAt",label:"创建时间","min-width":"140"}),(0,r.Wm)(U,{label:"操作","min-width":"120",resizable:""},{default:(0,r.w5)((function(e){return[(0,r.Wm)(p,{type:"danger",size:"small",onClick:(0,u.iM)((function(n){return m.onRenewPassword(e.row.id)}),["stop"])},{default:(0,r.w5)((function(){return[l]})),_:2},1032,["onClick"])]})),_:1})]})),_:1},8,["data"])]})),_:1}),(0,r.Wm)(z,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(P,{layout:"sizes, prev, pager, next","hide-on-single-page":!1,currentPage:f.userPageData.number,"page-size":f.userPageQuery.size,"page-sizes":[10,15,20,30],"page-count":f.userPageData.totalPages,onSizeChange:m.onPageSizeChange,onCurrentChange:m.onPageChange},null,8,["currentPage","page-size","page-count","onSizeChange","onCurrentChange"])]})),_:1}),(0,r.Wm)(v,{modelValue:f.isShowUserDetailDrawer,"onUpdate:modelValue":n[3]||(n[3]=function(e){return f.isShowUserDetailDrawer=e}),title:"用户详情",direction:"rtl",size:"50%"},{default:(0,r.w5)((function(){return[(0,r.Wm)(O,{title:"基础信息",column:1,border:""},{default:(0,r.w5)((function(){return[(0,r.Wm)(S,{label:"ID"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(f.userDetailData.id),1)]})),_:1}),(0,r.Wm)(S,{label:"昵称"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(f.userDetailData.nickname),1)]})),_:1}),(0,r.Wm)(S,{label:"用户名"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(f.userDetailData.username),1)]})),_:1}),(0,r.Wm)(S,{label:"邮箱",span:2},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(f.userDetailData.email),1)]})),_:1}),(0,r.Wm)(S,{label:"启用状态",span:2},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(f.userDetailData.enabled?"启用中":"已禁用"),1)]})),_:1}),(0,r.Wm)(S,{label:"注册时间",span:2},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(f.userDetailData.createAt),1)]})),_:1})]})),_:1}),o,i,(0,r.Wm)(V,{data:f.userDetailData.roles,stripe:""},{default:(0,r.w5)((function(){return[(0,r.Wm)(U,{label:"角色",prop:"role",formatter:f.roleNameFormatter},null,8,["formatter"]),(0,r.Wm)(U,{label:"所属分组"},{default:(0,r.w5)((function(e){return[e.row.groupId?((0,r.wg)(),(0,r.j4)(y,{key:0,onClick:function(n){return m.toGroupPage(e.row.groupId,e.row.groupName)}},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,a.zw)(e.row.groupName)+" ",1),(0,r.Wm)(R,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(E)]})),_:1})]})),_:2},1032,["onClick"])):(0,r.kq)("",!0)]})),_:1}),(0,r.Wm)(U,{prop:"groupId",label:"分组 ID"}),(0,r.Wm)(U,{prop:"createAt",label:"角色分配时间"})]})),_:1},8,["data"])]})),_:1},8,["modelValue"]),(0,r.Wm)(Z,{modelValue:f.isShowEditUserDialog,"onUpdate:modelValue":n[11]||(n[11]=function(e){return f.isShowEditUserDialog=e}),width:"38%",center:"","destroy-on-close":"",title:"创建用户"},{default:(0,r.w5)((function(){return[(0,r.Wm)(I,{model:f.userData,"label-position":"top",rules:f.userFormRule,ref:"userFormRef"},{default:(0,r.w5)((function(){return[(0,r.Wm)(Q,{label:"昵称",prop:"nickname"},{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{modelValue:f.userData.nickname,"onUpdate:modelValue":n[4]||(n[4]=function(e){return f.userData.nickname=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Q,{label:"用户名",prop:"username"},{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{modelValue:f.userData.username,"onUpdate:modelValue":n[5]||(n[5]=function(e){return f.userData.username=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Q,{label:"邮箱",prop:"email"},{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{modelValue:f.userData.email,"onUpdate:modelValue":n[6]||(n[6]=function(e){return f.userData.email=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Q,{label:"密码",prop:"password"},{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{modelValue:f.userData.password,"onUpdate:modelValue":n[7]||(n[7]=function(e){return f.userData.password=e}),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Q,{label:"启用状态"},{default:(0,r.w5)((function(){return[(0,r.Wm)(C,{modelValue:f.userData.enabled,"onUpdate:modelValue":n[8]||(n[8]=function(e){return f.userData.enabled=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Q,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(p,{type:"primary",plain:"",onClick:n[9]||(n[9]=function(e){return m.onSaveUserData("userFormRef")})},{default:(0,r.w5)((function(){return[s]})),_:1}),(0,r.Wm)(p,{plain:"",onClick:n[10]||(n[10]=function(e){return f.isShowEditUserDialog=!1})},{default:(0,r.w5)((function(){return[d]})),_:1})]})),_:1})]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"])]})),_:1})}var f=t(3110),m=t(7234),p={data:function(){return{loading:{sysOwnerLoading:!1,userEnableLoading:!1},userData:{enabled:!1},userFormRule:{nickname:[this.requiredInputValidRule("昵称不能为空")],username:[this.requiredInputValidRule("用户名不能为空")],email:[this.requiredInputValidRule("邮箱不能为空"),{type:"email",message:"邮箱格式不正确",trigger:"blur"}],password:[this.requiredInputValidRule("密码不能为空"),{min:6,max:18,message:"密码位数位数要求在 6~18 之间",trigger:"blur"}]},userPageData:{content:[]},userPageQuery:{nicknameOrUsernameOrEmailContains:null,enabled:null,page:0,size:10},userDetailData:{},isShowUserDetailDrawer:!1,isShowEditUserDialog:!1,roleNameFormatter:function(e,n,t){return"SYS_OWNER"==t?"系统管理员":"GROUP_OWNER"==t?"组长":"GROUP_MEMBER"==t?"组员":t}}},created:function(){this.fetchUsers()},methods:{fetchUsers:function(){var e=this;(0,f.yw)(this.userPageQuery).then((function(n){n.errCode||(e.userPageData=n.data,e.userPageData.number=n.data.number+1)}))},requiredInputValidRule:function(e){return{required:!0,message:e,trigger:"blur"}},onSwitchEnabled:function(e,n){n?(0,f.Dx)(e):(0,f.B9)(e)},onRenewPassword:function(e){this.$confirm("确认重置该用户密码？新密码将通过邮件下发","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,f.oD)(e).then((function(e){e.errCode||(0,m.z8)({showClose:!0,message:"密码重置成功",type:"success",duration:3e3})}))}))},onPageChange:function(e){e&&e-1!=this.userPageQuery.page&&(this.userPageQuery.page=e-1,this.fetchUsers())},onPageSizeChange:function(e){e&&(this.userPageQuery.size=e,this.fetchUsers())},onQuery:function(){this.userPageQuery.page=0,this.fetchUsers()},onGetUserDetail:function(e){var n=this;this.isShowUserDetailDrawer=!0,(0,f.__)(e.id).then((function(e){e.errCode||(n.userDetailData=e.data)}))},onSaveUserData:function(){var e=this;this.$refs.userFormRef.validate((function(n){return!!n&&((0,f.r4)(e.userData).then((function(n){n.errCode||(e.$message.success("保存用户成功"),e.isShowEditUserDialog=!1,e.userData={enabled:!1},e.fetchUsers())})),!0)}))},onChangeSysOwner:function(e){var n=this,t=e.id;return this.loading.sysOwnerLoading=!0,e.isSysOwner?(0,f._)(t).then((function(e){e.errCode||n.$message.success("启用系统管理员成功"),n.loading.sysOwnerLoading=!1})):(0,f.Uz)(t).then((function(e){e.errCode||n.$message.warning("禁用系统管理员成功"),n.loading.sysOwnerLoading=!1}))},toCreatePage:function(){this.isShowEditUserDialog=!0},toGroupPage:function(e,n){e&&this.$router.push({path:"/groups/"+e,query:{groupName:n}})}}},w=t(3744);const g=(0,w.Z)(p,[["render",c]]);var h=g}}]);
//# sourceMappingURL=719-legacy.94f86cce.js.map