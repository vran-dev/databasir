"use strict";(self["webpackChunkdatabasir"]=self["webpackChunkdatabasir"]||[]).push([[559],{7042:function(e,t,n){var r=n(2109),u=n(7854),o=n(3157),a=n(4411),i=n(111),l=n(1400),c=n(6244),s=n(5656),p=n(6135),f=n(5112),d=n(1194),g=n(206),m=d("slice"),w=f("species"),h=u.Array,W=Math.max;r({target:"Array",proto:!0,forced:!m},{slice:function(e,t){var n,r,u,f=s(this),d=c(f),m=l(e,d),_=l(void 0===t?d:t,d);if(o(f)&&(n=f.constructor,a(n)&&(n===h||o(n.prototype))?n=void 0:i(n)&&(n=n[w],null===n&&(n=void 0)),n===h||void 0===n))return g(f,m,_);for(r=new(void 0===n?h:n)(W(_-m,0)),u=0;m<_;m++,u++)m in f&&p(r,u,f[m]);return r.length=u,r}})},1559:function(e,t,n){n.r(t),n.d(t,{default:function(){return G}});n(8309),n(2526),n(1817),n(7042);var r=n(6252),u=n(9963),o=n(3577),a=["onClick"],i={style:{color:"#909399","font-size":"13px"}},l={style:{color:"#909399"}},c={key:1},s=(0,r.Uk)(" 更多 "),p=(0,r.Uk)("查看文档"),f=(0,r.Uk)("取消关注"),d=(0,r.Uk)("删除项目"),g=(0,r._)("h2",null,"组长管理",-1),m=(0,r.Uk)("保存"),w=(0,r.Uk)("取消"),h=(0,r.Uk)("删除分组"),W=(0,r.Uk)("确认删除分组");function _(e,t,n,_,v,D){var P=(0,r.up)("el-button"),y=(0,r.up)("el-tooltip"),k=(0,r.up)("el-col"),b=(0,r.up)("el-input"),C=(0,r.up)("el-row"),j=(0,r.up)("el-empty"),O=(0,r.up)("el-link"),G=(0,r.up)("el-divider"),E=(0,r.up)("user"),z=(0,r.up)("el-icon"),U=(0,r.up)("el-tag"),R=(0,r.up)("arrow-down"),N=(0,r.up)("el-dropdown-item"),S=(0,r.up)("el-dropdown-menu"),T=(0,r.up)("el-dropdown"),V=(0,r.up)("el-space"),F=(0,r.up)("folder"),I=(0,r.up)("el-card"),x=(0,r.up)("el-main"),$=(0,r.up)("el-pagination"),Q=(0,r.up)("el-footer"),q=(0,r.up)("el-container"),A=(0,r.up)("el-tab-pane"),L=(0,r.up)("el-table-column"),Y=(0,r.up)("database-icon"),M=(0,r.up)("el-table"),H=(0,r.up)("el-tabs"),B=(0,r.up)("el-form-item"),K=(0,r.up)("el-autocomplete"),Z=(0,r.up)("el-form"),J=(0,r.up)("warning-filled"),X=(0,r.up)("el-collapse-item"),ee=(0,r.up)("el-collapse"),te=(0,r.up)("el-dialog"),ne=(0,r.Q2)("require-roles");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(H,{modelValue:D.activeTab,"onUpdate:modelValue":t[3]||(t[3]=function(e){return D.activeTab=e}),onTabClick:D.onTabClick},{default:(0,r.w5)((function(){return[(0,r.Wm)(A,{label:"项目分组",name:"groupListTab"},{default:(0,r.w5)((function(){return[(0,r.Wm)(q,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(x,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(C,{gutter:12},{default:(0,r.w5)((function(){return[(0,r.wy)(((0,r.wg)(),(0,r.j4)(k,{span:3},{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{content:"创建一个分组",placement:"top"},{default:(0,r.w5)((function(){return[(0,r.Wm)(P,{type:"primary",icon:"plus",style:{width:"100%"},onClick:t[0]||(t[0]=function(e){return D.toCreatePage()})})]})),_:1})]})),_:1})),[[ne,["SYS_OWNER"]]]),(0,r.Wm)(k,{span:8},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{onChange:D.onQuery,modelValue:v.groupPageQuery.groupNameContains,"onUpdate:modelValue":t[1]||(t[1]=function(e){return v.groupPageQuery.groupNameContains=e}),label:"组名",placeholder:"组名称搜索","prefix-icon":"search"},null,8,["onChange","modelValue"])]})),_:1})]})),_:1}),0==v.groupPageData.data.length?((0,r.wg)(),(0,r.j4)(C,{key:0},{default:(0,r.w5)((function(){return[(0,r.Wm)(k,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(j,{description:"请先创建分组"})]})),_:1})]})),_:1})):((0,r.wg)(!0),(0,r.iD)(r.HY,{key:1},(0,r.Ko)(D.partitionArray(4,v.groupPageData.data),(function(e,n){return(0,r.wg)(),(0,r.j4)(C,{gutter:20,key:n},{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e,(function(e){return(0,r.wg)(),(0,r.j4)(k,{span:6,key:e.id},{default:(0,r.w5)((function(){return[(0,r.Wm)(I,{shadow:"hover",onMouseenter:function(t){return v.mouseEnterGroupId=e.id},onMouseleave:t[2]||(t[2]=function(e){return v.mouseEnterGroupId=null})},{default:(0,r.w5)((function(){return[(0,r.Wm)(G,{"content-position":"right"},{default:(0,r.w5)((function(){return[(0,r.wy)((0,r.Wm)(O,{underline:!1,onClick:function(t){return D.toEditPage(e.id,e.name)},icon:"Edit",style:{"margin-right":"8px"}},null,8,["onClick"]),[[u.F8,e.id==v.mouseEnterGroupId],[ne,["SYS_OWNER","GROUP_OWNER?groupId="+e.id]]]),(0,r.Wm)(O,{underline:!1},{default:(0,r.w5)((function(){return[(0,r._)("span",{onClick:function(t){return D.toGroupDashboard(e.id,e.name)}},[(0,r._)("h4",null,(0,o.zw)(e.name),1)],8,a)]})),_:2},1024)]})),_:2},1024),(0,r.Wm)(V,{direction:"vertical",alignment:"stretch",size:16},{default:(0,r.w5)((function(){return[(0,r._)("span",i,(0,o.zw)(e.description),1),(0,r.Wm)(V,{wrap:""},{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{content:"组长"},{default:(0,r.w5)((function(){return[(0,r.Wm)(z,{color:"#909399"},{default:(0,r.w5)((function(){return[(0,r.Wm)(E)]})),_:1})]})),_:1}),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.groupOwnerNames.slice(0,2),(function(e,t){return(0,r.wg)(),(0,r.j4)(U,{key:t,type:"info"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,o.zw)(e),1)]})),_:2},1024)})),128)),e.groupOwnerNames.length>2?((0,r.wg)(),(0,r.j4)(T,{key:0},{dropdown:(0,r.w5)((function(){return[(0,r.Wm)(S,null,{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.groupOwnerNames.slice(3),(function(e,t){return(0,r.wg)(),(0,r.j4)(N,{key:t},{default:(0,r.w5)((function(){return[(0,r.Wm)(U,{type:"info"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,o.zw)(e),1)]})),_:2},1024)]})),_:2},1024)})),128))]})),_:2},1024)]})),default:(0,r.w5)((function(){return[(0,r.Wm)(z,{class:"el-icon--right"},{default:(0,r.w5)((function(){return[(0,r.Wm)(R)]})),_:1})]})),_:2},1024)):(0,r.kq)("",!0)]})),_:2},1024),(0,r.Wm)(V,{wrap:""},{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{content:"项目数"},{default:(0,r.w5)((function(){return[(0,r.Wm)(z,{color:"#909399"},{default:(0,r.w5)((function(){return[(0,r.Wm)(F)]})),_:1})]})),_:1}),(0,r._)("span",l,(0,o.zw)(e.projectCount),1)]})),_:2},1024)]})),_:2},1024)]})),_:2},1032,["onMouseenter"])]})),_:2},1024)})),128))]})),_:2},1024)})),128))]})),_:1}),(0,r.Wm)(Q,null,{default:(0,r.w5)((function(){return[(0,r.Wm)($,{layout:"prev, pager, next","hide-on-single-page":!1,currentPage:v.groupPageData.number,"page-size":v.groupPageData.size,"page-count":v.groupPageData.totalPages,onCurrentChange:D.onPageChange},null,8,["currentPage","page-size","page-count","onCurrentChange"])]})),_:1})]})),_:1})]})),_:1}),(0,r.Wm)(A,{label:"关注项目",name:"favoriteProjectListTab"},{default:(0,r.w5)((function(){return[(0,r.Wm)(q,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(x,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(M,{data:v.favoriteProjectPageData.data,stripe:""},{default:(0,r.w5)((function(){return[(0,r.Wm)(L,{prop:"projectId",label:"项目 ID"}),(0,r.Wm)(L,{prop:"projectName",label:"项目名称"},{default:(0,r.w5)((function(e){return[(0,r.Wm)(O,{onClick:function(t){return D.toDocumentPage(e.row)}},{default:(0,r.w5)((function(){return[(0,r._)("span",null,(0,o.zw)(e.row.projectName),1)]})),_:2},1032,["onClick"])]})),_:1}),(0,r.Wm)(L,{prop:"projectDescription",label:"项目描述"}),(0,r.Wm)(L,{label:"定时同步",align:"center"},{default:(0,r.w5)((function(e){return[e.row.isAutoSync?((0,r.wg)(),(0,r.j4)(U,{key:0},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,o.zw)(e.row.autoSyncCron),1)]})),_:2},1024)):((0,r.wg)(),(0,r.iD)("span",c," 无 "))]})),_:1}),(0,r.Wm)(L,{label:"数据库类型"},{default:(0,r.w5)((function(e){return[(0,r.Wm)(Y,{databaseType:e.row.databaseType},null,8,["databaseType"])]})),_:1}),(0,r.Wm)(L,{prop:"databaseName",label:"数据库名称"}),(0,r.Wm)(L,{prop:"groupName",label:"所属分组"},{default:(0,r.w5)((function(e){return[(0,r.Wm)(O,{onClick:function(t){return D.toGroupDashboard(e.row.groupId,e.row.groupName)},icon:"List"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,o.zw)(e.row.groupName),1)]})),_:2},1032,["onClick"])]})),_:1}),(0,r.Wm)(L,{prop:"createAt",label:"关注时间"}),(0,r.Wm)(L,{label:"操作"},{default:(0,r.w5)((function(t){return[(0,r.Wm)(T,null,{dropdown:(0,r.w5)((function(){return[(0,r.Wm)(S,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(N,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(P,{type:"primary",size:"small",onClick:(0,u.iM)((function(e){return D.toDocumentPage(t.row)}),["stop"]),icon:"View"},{default:(0,r.w5)((function(){return[p]})),_:2},1032,["onClick"])]})),_:2},1024),(0,r.Wm)(N,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(P,{type:"warning",size:"small",onClick:(0,u.iM)((function(e){return D.onRemoveFavorite(t.row.projectId)}),["stop"]),icon:"StarFilled"},{default:(0,r.w5)((function(){return[f]})),_:2},1032,["onClick"])]})),_:2},1024),(0,r.wy)(((0,r.wg)(),(0,r.j4)(N,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(P,{type:"danger",size:"small",onClick:(0,u.iM)((function(e){return D.onProjectDelete(t.row.projectId)}),["stop"]),icon:"Remove"},{default:(0,r.w5)((function(){return[d]})),_:2},1032,["onClick"])]})),_:2},1024)),[[ne,["SYS_OWNER","GROUP_OWNER?groupId="+e.groupId]]])]})),_:2},1024)]})),default:(0,r.w5)((function(){return[(0,r._)("span",null,[s,(0,r.Wm)(z,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(R)]})),_:1})])]})),_:2},1024)]})),_:1})]})),_:1},8,["data"])]})),_:1}),(0,r.Wm)(Q,null,{default:(0,r.w5)((function(){return[(0,r.Wm)($,{layout:"prev, pager, next","hide-on-single-page":!1,currentPage:v.favoriteProjectPageData.number,"page-size":v.favoriteProjectPageData.size,"page-count":v.favoriteProjectPageData.totalPages,onCurrentChange:D.onFavoriteProjectPageChange},null,8,["currentPage","page-size","page-count","onCurrentChange"])]})),_:1})]})),_:1})]})),_:1})]})),_:1},8,["modelValue","onTabClick"]),(0,r.Wm)(te,{modelValue:v.isShowEditGroupDialog,"onUpdate:modelValue":t[10]||(t[10]=function(e){return v.isShowEditGroupDialog=e}),width:"38%",center:"","destroy-on-close":""},{default:(0,r.w5)((function(){return[(0,r.Wm)(Z,{model:v.groupData,rules:v.groupDataRule,ref:"groupFormRef","label-position":"top"},{default:(0,r.w5)((function(){return[(0,r.Wm)(B,{label:"名称",prop:"name"},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{modelValue:v.groupData.name,"onUpdate:modelValue":t[4]||(t[4]=function(e){return v.groupData.name=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(B,{label:"描述",prop:"description"},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{modelValue:v.groupData.description,"onUpdate:modelValue":t[5]||(t[5]=function(e){return v.groupData.description=e}),type:"textarea"},null,8,["modelValue"])]})),_:1}),g,(0,r.Wm)(B,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(K,{modelValue:v.userQueryData.nicknameOrUsernameOrEmailContains,"onUpdate:modelValue":t[6]||(t[6]=function(e){return v.userQueryData.nicknameOrUsernameOrEmailContains=e}),"fetch-suggestions":D.queryUsersAsync,placeholder:"用户名、昵称或邮箱搜索",onSelect:D.onGroupOwnerSelect,clearable:""},null,8,["modelValue","fetch-suggestions","onSelect"])]})),_:1}),(0,r.Wm)(B,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(V,{wrap:""},{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(v.groupData.groupOwners,(function(e,t){return(0,r.wg)(),(0,r.j4)(U,{key:e.id,type:"primary",size:"large",closable:"","disable-transitions":!1,onClose:function(e){return D.onGroupOwnerRemove(t)}},{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{content:e.email,placement:"top"},{default:(0,r.w5)((function(){return[(0,r._)("span",null,(0,o.zw)(e.nickname),1)]})),_:2},1032,["content"])]})),_:2},1032,["onClose"])})),128))]})),_:1})]})),_:1}),(0,r.Wm)(B,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(P,{type:"primary",onClick:t[7]||(t[7]=function(e){return D.onGroupSave("groupFormRef")})},{default:(0,r.w5)((function(){return[m]})),_:1}),(0,r.Wm)(P,{onClick:t[8]||(t[8]=function(e){return v.isShowEditGroupDialog=!1})},{default:(0,r.w5)((function(){return[w]})),_:1})]})),_:1})]})),_:1},8,["model","rules"]),v.groupData.id?((0,r.wg)(),(0,r.j4)(ee,{key:0},{default:(0,r.w5)((function(){return[(0,r.Wm)(X,{name:"1"},{title:(0,r.w5)((function(){return[(0,r.Wm)(z,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(J)]})),_:1}),h]})),default:(0,r.w5)((function(){return[(0,r.Wm)(y,{content:"数据一旦删除将无法恢复，谨慎操作",placement:"top"},{default:(0,r.w5)((function(){return[(0,r.Wm)(P,{icon:"delete",size:"large",style:{width:"100%",margin:"0 auto"},onClick:t[9]||(t[9]=function(e){return D.onGroupDelete(v.groupData.id)})},{default:(0,r.w5)((function(){return[W]})),_:1})]})),_:1})]})),_:1})]})),_:1})):(0,r.kq)("",!0)]})),_:1},8,["modelValue"])],64)}var v=n(8534),D=(n(1249),n(561),n(1539),n(5666),n(8337)),P=n(3110),y=n(9080),k=n(9324),b=n(1836),C={data:function(){return{isShowEditGroupDialog:!1,mouseEnterGroupId:null,groupData:{groupOwners:[]},groupDataRule:{name:[this.requiredInputValidRule("请输入有效昵称")],description:[this.requiredInputValidRule("请输入有效邮箱")]},userQueryData:{nicknameContains:null,nicknameOrUsernameOrEmailContains:null,size:50},groupPageData:{data:[],number:1,size:15,totalElements:0,totalPages:0},groupPageQuery:{page:0,size:15,groupNameContains:null},favoriteProjectPageData:{data:[],number:1,size:15,totalElements:0,totalPages:0},favoriteProjectPageQuery:{page:0,size:20,projectNameContains:null}}},created:function(){this.fetchGroupsFunction(),this.onFavoriteProjectPageChange(1)},computed:{activeTab:{get:function(){return this.$store.state.groupListActiveTab?this.$store.state.groupListActiveTab:(this.$store.commit("switchGroupListActiveTab","groupListTab"),"groupListTab")},set:function(e){this.$store.commit("switchGroupListActiveTab",e)}}},methods:{isPermit:function(e){return b.E.hasAnyRoles([e])},fetchUserFavorites:function(){var e=this;return(0,v.Z)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,y.V$)(e.favoriteProjectPageQuery);case 2:n=t.sent,e.favoriteProjectPageData.data=n.data.content,e.favoriteProjectPageData.number=n.data.number+1,e.favoriteProjectPageData.size=n.data.size,e.favoriteProjectPageData.totalPages=n.data.totalPages,e.favoriteProjectPageData.totalElements=n.data.totalElements;case 8:case"end":return t.stop()}}),t)})))()},fetchGroupsFunction:function(){var e=this;return(0,v.Z)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,D.Wq)(e.groupPageQuery);case 2:n=t.sent,e.groupPageData.data=n.data.content,e.groupPageData.number=n.data.number+1,e.groupPageData.size=n.data.size,e.groupPageData.totalPages=n.data.totalPages,e.groupPageData.totalElements=n.data.totalElements;case 8:case"end":return t.stop()}}),t)})))()},requiredInputValidRule:function(e){return{required:!0,message:e,trigger:"blur"}},requiredGroupOwners:function(){return!(null==this.groupData.groupOwners||this.groupData.groupOwners.length<1||this.groupData.groupOwners.length>20)},partitionArray:function(e,t){for(var n=[],r=0,u=0;u<t.length;u+=e)n[r++]=t.slice(u,u+e);return n},onPageChange:function(e){e&&(this.groupPageQuery.page=e-1,this.fetchGroupsFunction())},onQuery:function(){this.fetchGroupsFunction()},queryUsersAsync:function(e,t){var n=this;return(0,v.Z)(regeneratorRuntime.mark((function e(){var r,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,P.yw)(n.userQueryData).then((function(e){return e.data.content}));case 2:r=e.sent,u=r.map((function(e){return{value:e.nickname,nickname:e.nickname,email:e.email,id:e.id}})),t(u);case 5:case"end":return e.stop()}}),e)})))()},onGroupDelete:function(e){var t=this;this.$confirm("确认删除该分组？删除后数据将无法恢复","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,D.iE)(e).then((function(e){e.errCode||(t.$message.success("删除成功"),t.isShowEditGroupDialog=!1,t.fetchGroupsFunction())}))}))},onGroupSave:function(){var e=this;this.requiredGroupOwners()?this.$refs.groupFormRef.validate((function(t){if(t){var n=Object.assign({},e.groupData);n.groupOwnerUserIds=e.groupData.groupOwners.map((function(e){return e.id})),(0,D.vB)(n).then((function(t){t.errCode||(e.$message.success("保存成功"),e.isShowEditGroupDialog=!1,e.groupData={groupOwners:[]},e.fetchGroupsFunction())}))}else e.$message.error("请填写表单必填项")})):this.$message.warning("组长人数至少需要 1 人，最多为 20 人")},onGroupOwnerRemove:function(e){this.groupData.groupOwners.splice(e,1)},onGroupOwnerSelect:function(e){this.groupData.groupOwners.some((function(t){return t.id==e.id}))||this.groupData.groupOwners.push(e),this.userQueryData.nicknameOrUsernameOrEmailContains=null},toCreatePage:function(){this.isShowEditGroupDialog=!0,this.groupData={groupOwners:[]}},toEditPage:function(e){var t=this;(0,D.ex)(e).then((function(e){e.errCode||(t.isShowEditGroupDialog=!0,t.groupData=e.data)}))},toGroupDashboard:function(e,t){this.$router.push({path:"/groups/"+e,query:{groupName:t}})},toDocumentPage:function(e){var t=e.groupId,n=e.projectId;this.$router.push({path:"/groups/"+t+"/projects/"+n+"/documents",query:{projectName:e.projectName,groupName:e.groupName}})},onFavoriteProjectPageChange:function(e){e&&(this.favoriteProjectPageQuery.page=e-1,this.fetchUserFavorites())},onRemoveFavorite:function(e){var t=this;(0,y.Ni)(e).then((function(e){e.errCode||(t.$message.success("成功取消"),t.fetchUserFavorites())}))},onProjectDelete:function(e){var t=this;this.$confirm("确认删除该项目？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,k.jI)(t.groupId,e).then((function(e){e.errCode||(t.$message.success("删除成功"),t.fetchUserFavorites())}))}))},onTabClick:function(e){this.$store.commit("switchGroupListActiveTab",e.props.name)}}},j=n(3744);const O=(0,j.Z)(C,[["render",_]]);var G=O}}]);
//# sourceMappingURL=559-legacy.9d1817b6.js.map