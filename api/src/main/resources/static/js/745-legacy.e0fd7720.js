"use strict";(self["webpackChunkdatabasir"]=self["webpackChunkdatabasir"]||[]).push([[745],{63110:function(e,n,t){t.d(n,{yw:function(){return a},Dx:function(){return l},B9:function(){return o},__:function(){return i},IJ:function(){return s},r4:function(){return d},oD:function(){return c},_:function(){return f},Uz:function(){return m},gQ:function(){return p},Gz:function(){return w}});var r=t(63872),u="/api/v1.0/users",a=function(e){return r.Z.get(u,{params:e})},l=function(e){return r.Z.post(u+"/"+e+"/enable")},o=function(e){return r.Z.post(u+"/"+e+"/disable")},i=function(e){return r.Z.get(u+"/"+e)},s=function(e){return r.Z["delete"](u+"/"+e)},d=function(e){return r.Z.post(u,e)},c=function(e){return r.Z.post(u+"/"+e+"/renew_password")},f=function(e){return r.Z.post(u+"/"+e+"/sys_owners")},m=function(e){return r.Z["delete"](u+"/"+e+"/sys_owners")},p=function(e,n){return r.Z.post(u+"/"+e+"/password",n)},w=function(e,n){return r.Z.post(u+"/"+e+"/nickname",n)}},42745:function(e,n,t){t.r(n),t.d(n,{default:function(){return D}});var r=t(66252),u=t(3577),a=t(49963),l=(0,r.Uk)("重置密码"),o=(0,r.Uk)(" 删除账号 "),i=(0,r._)("br",null,null,-1),s=(0,r._)("h3",null,"角色信息",-1),d=(0,r.Uk)("保存"),c=(0,r.Uk)("取消");function f(e,n,t,f,m,p){var w=(0,r.up)("el-button"),g=(0,r.up)("el-tooltip"),h=(0,r.up)("el-col"),b=(0,r.up)("el-input"),D=(0,r.up)("el-row"),W=(0,r.up)("el-header"),_=(0,r.up)("el-table-column"),U=(0,r.up)("el-link"),C=(0,r.up)("arrow-down"),y=(0,r.up)("el-icon"),k=(0,r.up)("el-dropdown-item"),V=(0,r.up)("el-dropdown-menu"),z=(0,r.up)("el-dropdown"),S=(0,r.up)("el-switch"),P=(0,r.up)("el-space"),E=(0,r.up)("el-table"),v=(0,r.up)("el-main"),x=(0,r.up)("el-pagination"),O=(0,r.up)("el-footer"),R=(0,r.up)("el-descriptions-item"),L=(0,r.up)("el-descriptions"),Q=(0,r.up)("List"),I=(0,r.up)("el-drawer"),Z=(0,r.up)("el-form-item"),F=(0,r.up)("el-form"),q=(0,r.up)("el-dialog"),B=(0,r.up)("el-container");return(0,r.wg)(),(0,r.j4)(B,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(W,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{gutter:12},{default:(0,r.w5)((function(){return[(0,r.Wm)(h,{xs:24,sm:12,md:3,lg:2,xl:2,style:{"margin-bottom":"12px"}},{default:(0,r.w5)((function(){return[(0,r.Wm)(g,{content:"创建新用户",placement:"top"},{default:(0,r.w5)((function(){return[(0,r.Wm)(w,{type:"primary",icon:"plus",style:{width:"100%"},onClick:n[0]||(n[0]=function(e){return p.toCreatePage()})})]})),_:1})]})),_:1}),(0,r.Wm)(h,{xs:24,sm:12,md:6,lg:6,xl:6},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{onChange:p.onQuery,modelValue:m.userPageQuery.nicknameOrUsernameOrEmailContains,"onUpdate:modelValue":n[1]||(n[1]=function(e){return m.userPageQuery.nicknameOrUsernameOrEmailContains=e}),label:"用户名",placeholder:"昵称、用户名或邮箱搜索","prefix-icon":"search"},null,8,["onChange","modelValue"])]})),_:1})]})),_:1})]})),_:1}),(0,r.Wm)(v,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(D),(0,r.Wm)(E,{data:m.userPageData.content,width:"80%"},{default:(0,r.w5)((function(){return[(0,r.Wm)(_,{prop:"id",label:"ID","min-width":"60"}),(0,r.Wm)(_,{prop:"nickname",label:"昵称","min-width":"120",resizable:""}),(0,r.Wm)(_,{prop:"username",label:"用户名","min-width":"120",resizable:""}),(0,r.Wm)(_,{label:"邮箱",width:"200",resizable:""},{default:(0,r.w5)((function(e){return[(0,r.Wm)(U,{underline:!0,onClick:function(n){return p.onGetUserDetail(e.row)},type:"primary"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,u.zw)(e.row.email),1)]})),_:2},1032,["onClick"])]})),_:1}),(0,r.Wm)(_,{label:m.userEnabledColumnLabel,resizable:"",align:"center"},{header:(0,r.w5)((function(){return[(0,r.Wm)(z,null,{dropdown:(0,r.w5)((function(){return[(0,r.Wm)(V,null,{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(m.userEnabledStatusMap,(function(e,n){return(0,r.wg)(),(0,r.j4)(k,{key:n,onClick:function(n){return p.onEnabledStatusFilter(e)},icon:e.icon},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,u.zw)(e.text),1)]})),_:2},1032,["onClick","icon"])})),128))]})),_:1})]})),default:(0,r.w5)((function(){return[(0,r._)("span",null,[(0,r.Uk)((0,u.zw)(m.userEnabledColumnLabel)+" ",1),(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(C)]})),_:1})])]})),_:1})]})),default:(0,r.w5)((function(e){return[(0,r.Wm)(S,{modelValue:e.row.enabled,"onUpdate:modelValue":function(n){return e.row.enabled=n},loading:m.loading.userEnableLoading,onChange:function(n){return p.onSwitchEnabled(e.row.id,e.row.enabled)},disabled:p.shouldDisableSwitch(e.row)},null,8,["modelValue","onUpdate:modelValue","loading","onChange","disabled"])]})),_:1},8,["label"]),(0,r.Wm)(_,{label:"系统管理员"},{default:(0,r.w5)((function(e){return[(0,r.Wm)(S,{modelValue:e.row.isSysOwner,"onUpdate:modelValue":function(n){return e.row.isSysOwner=n},loading:m.loading.sysOwnerLoading,onChange:function(n){return p.onChangeSysOwner(e.row)},disabled:p.shouldDisableSwitch(e.row)},null,8,["modelValue","onUpdate:modelValue","loading","onChange","disabled"])]})),_:1}),(0,r.Wm)(_,{prop:"createAt",label:"创建时间","min-width":"140"}),(0,r.Wm)(_,{label:"操作","min-width":"120",resizable:""},{default:(0,r.w5)((function(e){return[(0,r.Wm)(P,{direction:"vertical"},{default:(0,r.w5)((function(){return[(0,r.Wm)(w,{icon:"Refresh",text:"",size:"small",onClick:(0,a.iM)((function(n){return p.onRenewPassword(e.row.id)}),["stop"]),bg:""},{default:(0,r.w5)((function(){return[l]})),_:2},1032,["onClick"]),(0,r.Wm)(w,{icon:"Delete",type:"danger",text:"",size:"small",onClick:(0,a.iM)((function(n){return p.onDeleteUser(e.row.id)}),["stop"]),bg:""},{default:(0,r.w5)((function(){return[o]})),_:2},1032,["onClick"])]})),_:2},1024)]})),_:1})]})),_:1},8,["data"])]})),_:1}),(0,r.Wm)(O,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(x,{layout:"sizes, prev, pager, next","hide-on-single-page":!1,currentPage:m.userPageData.number,"page-size":m.userPageQuery.size,"page-sizes":[10,15,20,30],"page-count":m.userPageData.totalPages,onSizeChange:p.onPageSizeChange,onCurrentChange:p.onPageChange},null,8,["currentPage","page-size","page-count","onSizeChange","onCurrentChange"])]})),_:1}),(0,r.Wm)(I,{modelValue:m.isShowUserDetailDrawer,"onUpdate:modelValue":n[2]||(n[2]=function(e){return m.isShowUserDetailDrawer=e}),title:"用户详情",direction:"rtl",size:"50%"},{default:(0,r.w5)((function(){return[(0,r.Wm)(L,{title:"基础信息",column:1,border:""},{default:(0,r.w5)((function(){return[(0,r.Wm)(R,{label:"ID"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,u.zw)(m.userDetailData.id),1)]})),_:1}),(0,r.Wm)(R,{label:"昵称"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,u.zw)(m.userDetailData.nickname),1)]})),_:1}),(0,r.Wm)(R,{label:"用户名"},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,u.zw)(m.userDetailData.username),1)]})),_:1}),(0,r.Wm)(R,{label:"邮箱",span:2},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,u.zw)(m.userDetailData.email),1)]})),_:1}),(0,r.Wm)(R,{label:"启用状态",span:2},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,u.zw)(m.userDetailData.enabled?"启用中":"已禁用"),1)]})),_:1}),(0,r.Wm)(R,{label:"注册时间",span:2},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,u.zw)(m.userDetailData.createAt),1)]})),_:1})]})),_:1}),i,s,(0,r.Wm)(E,{data:m.userDetailData.roles,stripe:""},{default:(0,r.w5)((function(){return[(0,r.Wm)(_,{label:"角色",prop:"role",formatter:m.roleNameFormatter},null,8,["formatter"]),(0,r.Wm)(_,{label:"所属分组"},{default:(0,r.w5)((function(e){return[e.row.groupId?((0,r.wg)(),(0,r.j4)(U,{key:0,onClick:function(n){return p.toGroupPage(e.row.groupId,e.row.groupName)}},{default:(0,r.w5)((function(){return[(0,r.Uk)((0,u.zw)(e.row.groupName)+" ",1),(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(Q)]})),_:1})]})),_:2},1032,["onClick"])):(0,r.kq)("",!0)]})),_:1}),(0,r.Wm)(_,{prop:"groupId",label:"分组 ID"}),(0,r.Wm)(_,{prop:"createAt",label:"角色分配时间"})]})),_:1},8,["data"])]})),_:1},8,["modelValue"]),(0,r.Wm)(q,{modelValue:m.isShowEditUserDialog,"onUpdate:modelValue":n[10]||(n[10]=function(e){return m.isShowEditUserDialog=e}),width:"38%",center:"","destroy-on-close":"",title:"创建用户"},{default:(0,r.w5)((function(){return[(0,r.Wm)(F,{model:m.userData,"label-position":"top",rules:m.userFormRule,ref:"userFormRef"},{default:(0,r.w5)((function(){return[(0,r.Wm)(Z,{label:"昵称",prop:"nickname"},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{modelValue:m.userData.nickname,"onUpdate:modelValue":n[3]||(n[3]=function(e){return m.userData.nickname=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Z,{label:"用户名",prop:"username"},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{modelValue:m.userData.username,"onUpdate:modelValue":n[4]||(n[4]=function(e){return m.userData.username=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Z,{label:"邮箱",prop:"email"},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{modelValue:m.userData.email,"onUpdate:modelValue":n[5]||(n[5]=function(e){return m.userData.email=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Z,{label:"密码",prop:"password"},{default:(0,r.w5)((function(){return[(0,r.Wm)(b,{modelValue:m.userData.password,"onUpdate:modelValue":n[6]||(n[6]=function(e){return m.userData.password=e}),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Z,{label:"启用状态"},{default:(0,r.w5)((function(){return[(0,r.Wm)(S,{modelValue:m.userData.enabled,"onUpdate:modelValue":n[7]||(n[7]=function(e){return m.userData.enabled=e})},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(Z,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(w,{type:"primary",plain:"",onClick:n[8]||(n[8]=function(e){return p.onSaveUserData("userFormRef")})},{default:(0,r.w5)((function(){return[d]})),_:1}),(0,r.Wm)(w,{plain:"",onClick:n[9]||(n[9]=function(e){return m.isShowEditUserDialog=!1})},{default:(0,r.w5)((function(){return[c]})),_:1})]})),_:1})]})),_:1},8,["model","rules"])]})),_:1},8,["modelValue"])]})),_:1})}var m=t(63110),p=t(45244),w=t(51836),g={data:function(){return{loading:{sysOwnerLoading:!1,userEnableLoading:!1},userData:{enabled:!0},userFormRule:{nickname:[this.requiredInputValidRule("昵称不能为空")],username:[this.requiredInputValidRule("用户名不能为空")],email:[this.requiredInputValidRule("邮箱不能为空"),{type:"email",message:"邮箱格式不正确",trigger:"blur"}],password:[this.requiredInputValidRule("密码不能为空"),{min:6,max:18,message:"密码位数位数要求在 6~18 之间",trigger:"blur"}]},userPageData:{content:[]},userPageQuery:{nicknameOrUsernameOrEmailContains:null,enabled:null,page:0,size:10},userDetailData:{},userEnabledColumnLabel:"状态",userEnabledStatusMap:[{text:"启用",value:!0,icon:"CircleCheck"},{text:"禁用",value:!1,icon:"CircleClose"},{text:"全部",value:null,icon:"List"}],isShowUserDetailDrawer:!1,isShowEditUserDialog:!1,roleNameFormatter:function(e,n,t){return"SYS_OWNER"==t?"系统管理员":"GROUP_OWNER"==t?"组长":"GROUP_MEMBER"==t?"组员":t}}},created:function(){this.fetchUsers()},methods:{fetchUsers:function(){var e=this;(0,m.yw)(this.userPageQuery).then((function(n){n.errCode||(e.userPageData=n.data,e.userPageData.number=n.data.number+1)}))},requiredInputValidRule:function(e){return{required:!0,message:e,trigger:"blur"}},onSwitchEnabled:function(e,n){n?(0,m.Dx)(e):(0,m.B9)(e)},onEnabledStatusFilter:function(e){this.userPageQuery.enabled=e.value,null==e.value?this.userEnabledColumnLabel="状态":this.userEnabledColumnLabel=e.text,this.onQuery()},onRenewPassword:function(e){this.$confirm("确认重置该用户密码？新密码将通过邮件下发","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,m.oD)(e).then((function(e){e.errCode||(0,p.z8)({showClose:!0,message:"密码重置成功",type:"success",duration:3e3})}))}))},onDeleteUser:function(e){var n=this;this.$confirm("确认删除该用户吗？删除后无法恢复，请谨慎操作","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,m.IJ)(e).then((function(e){e.errCode||(n.fetchUsers(),(0,p.z8)({showClose:!0,message:"用户删除成功",type:"success",duration:3e3}))}))}))},onPageChange:function(e){e&&e-1!=this.userPageQuery.page&&(this.userPageQuery.page=e-1,this.fetchUsers())},onPageSizeChange:function(e){e&&(this.userPageQuery.size=e,this.fetchUsers())},onQuery:function(){this.userPageQuery.page=0,this.fetchUsers()},onGetUserDetail:function(e){var n=this;this.isShowUserDetailDrawer=!0,(0,m.__)(e.id).then((function(e){e.errCode||(n.userDetailData=e.data)}))},onSaveUserData:function(){var e=this;this.$refs.userFormRef.validate((function(n){return!!n&&((0,m.r4)(e.userData).then((function(n){n.errCode||(e.$message.success("保存用户成功"),e.isShowEditUserDialog=!1,e.userData={enabled:!1},e.fetchUsers())})),!0)}))},onChangeSysOwner:function(e){var n=this,t=e.id;return this.loading.sysOwnerLoading=!0,e.isSysOwner?(0,m._)(t).then((function(e){e.errCode||n.$message.success("启用系统管理员成功"),n.loading.sysOwnerLoading=!1})):(0,m.Uz)(t).then((function(e){e.errCode||n.$message.warning("禁用系统管理员成功"),n.loading.sysOwnerLoading=!1}))},toCreatePage:function(){this.isShowEditUserDialog=!0},toGroupPage:function(e,n){e&&this.$router.push({path:"/groups/"+e,query:{groupName:n}})},shouldDisableSwitch:function(e){var n=w.E.loadUserLoginData();return!(!n||n.id!=e.id)}}},h=t(83744);const b=(0,h.Z)(g,[["render",f]]);var D=b}}]);
//# sourceMappingURL=745-legacy.e0fd7720.js.map